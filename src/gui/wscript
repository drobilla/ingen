#!/usr/bin/env python
from waflib.extras import autowaf as autowaf
import waflib.Utils as Utils

def build(bld):
    obj = bld(features        = 'cxx cxxshlib',
              export_includes = ['../../include'],
              includes        = ['../..', '../../include'],
              name            = 'libingen_gui',
              target          = 'ingen_gui',
              install_path    = '${LIBDIR}',
              use             = 'libingen_shared libingen_client libingen_serialisation')
    autowaf.use_lib(bld, obj, '''
            CURL
            FLOWCANVAS
            GLADEMM
            GLIBMM
            GNOMECANVASMM
            GTKMM
            LILV
            LV2CORE
            RAUL
            SIGCPP
            SORD
            SOUP
            SUIL
            WEBKIT
    ''')

    obj.source = '''
            App.cpp
            BreadCrumbs.cpp
            Configuration.cpp
            ConnectWindow.cpp
            Connection.cpp
            ControlPanel.cpp
            Controls.cpp
            LoadPatchWindow.cpp
            LoadPluginWindow.cpp
            LoadRemotePatchWindow.cpp
            MessagesWindow.cpp
            NewSubpatchWindow.cpp
            NodeControlWindow.cpp
            NodeMenu.cpp
            NodeModule.cpp
            ObjectMenu.cpp
            PatchCanvas.cpp
            PatchPortModule.cpp
            PatchTreeWindow.cpp
            PatchView.cpp
            PatchWindow.cpp
            Port.cpp
            PortMenu.cpp
            PortPropertiesWindow.cpp
            PropertiesWindow.cpp
            RenameWindow.cpp
            SubpatchModule.cpp
            ThreadedLoader.cpp
            WidgetFactory.cpp
            Window.cpp
            WindowFactory.cpp
            ingen_gui.cpp
    '''

    if bld.is_defined('HAVE_CURL'):
        obj.source += 'UploadPatchWindow.cpp'

    # XML UI definition
    bld(features      = 'subst',
        source        = 'ingen_gui.ui',
        target        = '../../ingen_gui.ui',
        install_path  = '${DATADIR}/ingen',
        chmod         = Utils.O755,
        INGEN_VERSION = bld.env['INGEN_VERSION'])
